<!DOCTYPE HTML>
<html>
<head>
    <title>듀얼헬스케어:기업관리</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
            integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
            crossorigin="anonymous"></script>
    <script src="https://cdn.polyfill.io/v3/polyfill.min.js?features=default,Array.prototype.includes,Array.prototype.find"></script>
    <!--for ajax-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        ul {
            list-style: none;
        }

        .col-form-label {
            font-size: 18px;
            min-width: 130px;
        }

        table {
            text-align: center;
            margin: auto;
            vertical-align: middle;
            border-collapse: collapse;
            line-height: 30px;
            border-bottom: #E6E6E6 1px solid;
        }

        th {
            width: 130px;
            background: #E6E6E6;
            color: #444444;
        }

        tr {
            color: #444;
        }

        td {
            width: fit-content;
            border: 1px;
            solid: #efefef;
            font-size: 15px;
            vertical-align: middle;
        }

    </style>

</head>

<body>

<!--상단 네비바-->
<header>
    <% include top-menu %>
</header>
<!--상단 네비바-->

<!--콘텐츠 내용-->
<div class="container" style="padding-top: 50px; max-width: none">
    <div class="row">
        <div class="col">
            <form style="margin: 0 auto; width: 95%; max-width: 1150px; padding: 20px">
                <ul class="img-circle">
                    <div class="menu-title" style="font-size: 22px">
                        <img src="images/bg_h2_tit.png" style="margin-right: 10px;">
                        기업관리
                    </div>
                    <hr>
                    <div class="form-row row">
                        <label class="col-form-label">
                            <li>사업연도</li>
                        </label>
                        <div class="form-group col">
                            <select id="year" class="form-control">
                                <option selected>-전체-</option>
                            </select>
                        </div>
                        <label class="col-form-label" style="margin-left: 20px">
                            <li>서비스</li>
                        </label>
                        <div class="form-group col">
                            <select id="service" class="form-control">
                                <option selected>-전체-</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row row">
                        <label class="col-form-label">
                            <li>진행상태</li>
                        </label>
                        <div class="form-group col">
                            <select id="status" class="form-control">
                                <option selected>-전체-</option>
                            </select>
                        </div>
                        <label class="col-form-label" style="margin-left: 20px">
                            <li>계약유무</li>
                        </label>
                        <div class="form-group col">
                            <select id="contract" class="form-control">
                                <option selected>-전체-</option>
                            </select>
                        </div>
                    </div>
                    <hr>
                    <div style="float: right">
                        <div class="btn-purple-square" onclick="">
                            기업신규등록
                        </div>
                        <div class="btn-save-square"  onclick="searchInformation()">
                            검색
                        </div>
                    </div>
                </ul>
            </form>
        </div>
    </div>

    <div class="row" style="margin-top:100px">
        <div class="col">
            <div class="d-flex justify-content-center px-5">
                <h6>
                    <div style="margin-right: 15px">통합검색</div>
                    <div class="search">
                        <input type="text" class="search-input" placeholder="회사명으로 검색하세요" name="">
                        <div class="search-icon"><i class="fa fa-search"></i></div>
                    </div>
                </h6>
            </div>
        </div>
    </div>

    <div class="row " style="margin-left: 30px; margin-right: 30px; margin-top: 20px">
        <form class="table-responsive" style="margin: 0 auto">
            <div
                    class="btn-default-small excel" style="float: right"></div>
            <table id="compamynInfo" class="table table-hover" style="margin-top: 45px">
                <thead>
                <tr>
                    <th scope="col">NO</th>
                    <th scope="col">회사</th>
                    <th scope="col">사업장</th>
                    <th scope="col">서비스</th>
                    <th scope="col">계약유무</th>
                    <th scope="col">직원 수</th>
                    <th scope="col">진행현황</th>
                    <th scope="col">예약기간</th>
                    <th scope="col">검진기간</th>
                    <th scope="col">사업자 등록</th>
                </tr>
                </thead>
                <tbody>
                <tr>

                </tr>
                </tbody>
            </table>
        </form>

    </div>

</div>
<!--콘텐츠 내용-->


<!-- Modal -->
<div class="modal fade" id="companyDetailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog " style="max-width: fit-content; width: 1200px; display: table;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container company" style="margin-top: 30px">
                    <div class="row">
                        <div class="col">
                            <div class="menu-title" style="font-size: 22px; margin-bottom: 20px">
                                <img src="images/bg_h2_tit.png" style="margin-right: 10px;">
                                기업정보
                            </div>
                            <table class="table" id="info1">
                                <tbody>
                                <tr>
                                    <th>기업명</th>
                                    <td id="com-companyName" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>사업장</th>
                                    <td id="com-companyBranch" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>시스템오픈</th>
                                    <td id="com-systemOpen" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>서비스</th>
                                    <td id="com-serviceName"></td>
                                </tr>
                                <tr>
                                    <th>계약유무</th>
                                    <td id="com-contract" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>예약기간</th>
                                    <td id="com-reservation" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>검진기간</th>
                                    <td id="com-inspection" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>서비스이용료</th>
                                    <td id="com-rebatePrice" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>패키지</th>
                                    <td id="com-packagePriceList"></td>
                                </tr>
                                <tr>
                                    <th>지원금</th>
                                    <td id="com-supportPriceList"></td>
                                </tr>
                                <tr>
                                    <th>공단차감</th>
                                    <td id="com-pcDiscount" contentEditable="true"></td>
                                </tr>
                                <tr>
                                    <th>가족지원</th>
                                    <td id="com-familySupport" contentEditable="true"></td>
                                </tr>
                                </tbody>
                            </table>
                            <table class="table" id="info2">
                                <tbody>
                                <tr style="height: 200px">
                                    <th>관리자메모</th>
                                    <td id="com-memo" contentEditable="true"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col">
                            <div style="margin-bottom: 50px">
                                <div class="menu-title" style="font-size: 22px; margin-bottom: 20px">
                                    <img src="images/bg_h2_tit.png" style="margin-right: 10px;">
                                    담당자추가
                                    <div class="btn-save-square" style="padding: 2px 6px; font-size: 13px; margin-left: 10px">저장</div>
                                </div>
                                <table class="table" id="info3">
                                    <tbody>
                                    <tr>
                                        <th>이름</th>
                                        <td id="com-"></td>
                                    </tr>
                                    <tr>
                                        <th>연락처</th>
                                        <td id="com-"></td>
                                    </tr>
                                    <tr>
                                        <th>이메일</th>
                                        <td id="com-"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div style="margin-bottom: 50px;">
                                <div class="menu-title" style="font-size: 22px; margin-bottom: 20px">
                                    <img src="images/bg_h2_tit.png" style="margin-right: 10px;">
                                    청구정보
                                </div>
                                <table class="table" id="info4">
                                    <tbody>
                                    <tr>
                                        <th>청구방식</th>
                                        <td id="com-paymentCode" contentEditable="true"></td>
                                    </tr>
                                    <tr>
                                        <th>지원금방식</th>
                                        <td id="com-supportFundCode" contentEditable="true"></td>
                                    </tr>
                                    <tr>
                                        <th>추가금액<br>정산방식</th>
                                        <td id="com-balanceCode" contentEditable="true"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div>
                                <div class="menu-title" style="font-size: 22px; margin-bottom: 20px">
                                <img src="images/bg_h2_tit.png" style="margin-right: 10px;">
                                가족미지원
                            </div>
                                <table class="table" id="info5">
                                <tbody>
                                <tr>
                                    <th>패키지</th>
                                    <td id="com-fpackagePriceList"></td>
                                </tr>
                                <tr>
                                    <th>지원금</th>
                                    <td id="com-fsupportPriceList"></td>
                                </tr>
                                </tbody>
                            </table>
                            </div>
                        </div>
                        <div class="col">
                            <div class="menu-title" style="font-size: 22px; margin-bottom: 20px">
                                <img src="images/bg_h2_tit.png" style="margin-right: 10px;">
                                담당자정보
                            </div>
                            <div style="height: 900px; overflow-y: scroll">
                                <table class="table" id="info6">
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <div class="btn-save-square" style="float: right;" onclick="saveInformation()">저장</div>
            </div>
        </div>
    </div>
</div>

</body>
</html>

<script type="text/javascript">
    var token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJMU0giLCJleHAiOjE2MDMwOTU5MzJ9.ZrwYNSVhfzpHPxEI01PQ757Z7hvaFr1jDRiEvKFvb7U";
    const instance = axios.create({
        baseURL: "http://192.168.219.101:8080/master/api/v1/",
        timeout: 1000,
        headers: {'token': token}
    });
    //검색항목리스트
    instance.post('M004001_RES').then(res => {
        setCompanySelectData(res.data);
    });


    //검색
    function searchInformation() {
        var searchItems = new Object();

        $('#compamynInfo > tbody').empty();

        searchItems.year = $("#year option:selected").val();
        searchItems.service = $("#service option:selected").val();
        searchItems.status = $("#status option:selected").val();
        searchItems.contract = $("#contract option:selected").val();

        if (searchItems.year == "-전체-") {
            searchItems.year = "all";
        }
        if (searchItems.service == "-전체-") {
            searchItems.service = "all";
        }
        if (searchItems.status == "-전체-") {
            searchItems.status = "all";
        }
        if (searchItems.contract == "-전체-") {
            searchItems.contract = "all";
        }

        console.log(searchItems);

        instance.post('M004002_REQ_RES', searchItems).then(res => {
            setCompanyData(res.data);
        });
    }

    //검색 selector
    function setCompanySelectData(data) {
        console.log(data);
        //사업연도
        for (i = 0; i < data.year.length; i++) {
            var html = '';
            html += '<option>' + data.year[i] + '</option>'
            $("#year").append(html);
        }
        //서비스
        for (i = 0; i < data.service.length; i++) {
            var html = '';
            html += '<option>' + data.service[i] + '</option>'
            $("#service").append(html);
        }
        //진행상태
        for (i = 0; i < data.status.length; i++) {
            var html = '';
            html += '<option>' + data.status[i] + '</option>'
            $("#status").append(html);
        }
        //계약유무
        for (i = 0; i < data.contract.length; i++) {
            var html = '';
            html += '<option>' + data.contract[i] + '</option>'
            $("#contract").append(html);
        }
    }

    //예약관리 테이블
    function setCompanyData(data) {
        console.log(data);
        for (i = 0; i < data.length; i++) {
            var html = '';
            html += '<tr>"';
            html += '<td>' + data[i].id + '</td>';
            html += '<td data-toggle="modal" data-target="#companyDetailModal" onClick="clickDetail(\'' + data[i].id + '\')">' + data[i].name + '</td>';
            html += '<td>' + data[i].branch + '</td>';
            html += '<td>' + data[i].services + '</td>';
            html += '<td>' + data[i].contract + '</td>';
            html += '<td>' + data[i].customers + '</td>';
            html += '<td>' + data[i].status + '</td>';
            html += '<td>' + data[i].reservationStartDate + " ~ " + data[i].reservationEndDate + '</td>';
            html += '<td>' + data[i].inspectionStartDate + " ~ " + data[i].inspectionEndDate + '</td>';
            html += '<td>' + data[i].license + '</td>';
            html += '</tr>';

            $("#compamynInfo").append(html);
        }
    }

    //고객정보상세
    var cmnId = Object();

    function clickDetail(data) {
        cmnId.companyId = data;
        instance.post('M004003_REQ_RES', cmnId).then(res => {
            setDetailCostomerData(res.data);
        });
    }

    //클릭시 기업정보
    function setDetailCostomerData(data) {
        console.log(data);

        //info1 기업정보
        document.getElementById('com-companyName').innerHTML = data.companyName;
        document.getElementById('com-companyBranch').innerHTML = data.companyBranch;
        document.getElementById('com-systemOpen').innerHTML = data.systemOpen;
        document.getElementById('com-serviceName').innerHTML = data.serviceName;
        document.getElementById('com-contract').innerHTML = data.contract;
        document.getElementById('com-reservation').innerHTML = data.inspectionStartDate + " ~ " + data.inspectionEndDate;
        document.getElementById('com-inspection').innerHTML = data.reservationStartDate + " ~ " + data.reservationEndDate;
        document.getElementById('com-rebatePrice').innerHTML = data.rebatePrice;
        document.getElementById('com-packagePriceList').innerHTML = data.packagePriceList;
        document.getElementById('com-supportPriceList').innerHTML = data.supportPriceList;
        document.getElementById('com-pcDiscount').innerHTML = data.pcDiscount;
        document.getElementById('com-familySupport').innerHTML = data.familySupport;

        //info2 관리자메모
        document.getElementById('com-memo').innerHTML = data.memo;

        //info3 담당자추가

        //info4 청구정보
        document.getElementById('com-paymentCode').innerHTML = data.paymentCode;
        document.getElementById('com-supportFundCode').innerHTML = data.supportFundCode;
        document.getElementById('com-balanceCode').innerHTML = data.balanceCode;

        //info5 가족미지원
        document.getElementById('com-fpackagePriceList').innerHTML = data.fpackagePriceList;
        document.getElementById('com-fsupportPriceList').innerHTML = data.fsupportPriceList;

        //info6 담장자정보
        for (i = 0; i < data.companyManagerDTOList.length; i++) {
            var html = '';
            html += '<tr style="border-top: 2px solid #424242">';
            html += '<th>이름</th>';
            html += '<td>' + data.companyManagerDTOList[i].name + '</td>';
            html += '</tr>';
            html += '<tr>';
            html += '<th>연락처</th>';
            html += '<td>' + data.companyManagerDTOList[i].phone + '</td>';
            html += '</tr>';
            html += '<tr>';
            html += '<th>이메일</th>';
            html += '<td>' + data.companyManagerDTOList[i].email + '</td>';
            html += '</tr>';

            $("#info6").append(html);
        }
    }

    //수정된 정보로 저장
    function saveInformation() {
        var saveItems = new Object();

        saveItems.reservationId = rsvId.reservationId;
        saveItems.familyName = document.getElementById('com-familyName').innerText;
        saveItems.familyBirthDate = document.getElementById('com-familyBirthDate').innerText;
        saveItems.familyPhone = document.getElementById('com-familyPhone').innerText;
        saveItems.familyAddress = document.getElementById('com-familyAddress').innerText;
        saveItems.familyEmail = document.getElementById('com-familyEmail').innerText;
        saveItems.familyPcDiscount = document.getElementById('com-familyPcDiscount').innerText;
        saveItems.familyPsInfoDual = document.getElementById('com-familyPsInfoDual').innerText;
        saveItems.familyPsInfoHos = document.getElementById('com-familyPsInfoHos').innerText;
        saveItems.reservationFirstWishDate = document.getElementById('com-reservationFirstWishDate').innerText;
        saveItems.reservationSecondWishDate = document.getElementById('com-reservationSecondWishDate').innerText;
        saveItems.ipDate = document.getElementById('com-ipDate').innerText;
        saveItems.companySupportPrice = document.getElementById('com-companySupportPrice').innerText;
        saveItems.memo = document.getElementById('com-memo').innerText;

        console.log(saveItems);

        if (confirm("저장하시겠습니까?") == true){
            instance.post('M003004_REQ_RES', saveItems).then(res => {
                console.log(res.data.message);
                alert("저장되었습니다.");
            });
        }else{
            return false;
        }
    }
</script>
